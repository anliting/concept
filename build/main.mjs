let e=new Text;class t{constructor(e){this.p=e}doEffect(){}sub(t){return n=>{let r=n.node[0];t.undoEffect(n);let s=this.make(n.root),i=s.node,o=n.node,c=r.parentNode;c.insertBefore(e,r);let l=new DocumentFragment;l.append(...i),c.insertBefore(l,e),c.removeChild(e);for(let e of new Set(o).difference(new Set(i)))c.removeChild(e);return this.doEffect(s),s}}undoEffect(e){e.ended=1}}class n{constructor(e,t,n=[]){this.child=n,this.clean=1,this.concept=null,this.effect=[],this.ended=0,this.functionConcept=null,this.node=t,this.ref={},this.root=e}}let r=class extends t{sub(e){return e instanceof r?e=>{let t=this.make(e.root);return e.node[0].parentNode.replaceChild(t.node[0],e.node[0]),e.child=t.child,e.node=t.node,e}:super.sub(e)}},s=class extends r{constructor(e,t){super(e),this.t=t}make(e){return new n(e,[new Text(this.t)])}sub(e){return e instanceof s?this.t==e.t?e=>e:e=>(e.node[0].nodeValue=this.t,e):super.sub(e)}},i=(e,t)=>{for(let n of e)t.parentNode.insertBefore(n,t.nextSibling),t=n},o=class extends t{constructor(e={},t){super(e),this.c=t.map(e=>"string"==typeof e?new s({},e):Symbol.iterator in e?new o({},e):e)}doEffect(e){if(!e.ended){super.doEffect(e);for(let t=0;t<this.c.length;t++)this.c[t].doEffect(e.child[t])}}make(e){let t=this.c.map((t,n)=>t.make(e));return new n(e,[new Text,...t.flatMap(e=>e.node)],t)}sub(e){return e instanceof o?t=>{let n=t.node[0],r=[],s={};for(let[n,i]of e.c.entries()){let e=t.child[n].node;"key"in i.p?s[i.p.key]={i:n,node:e}:r.push({i:n,node:e}),e.at(-1)}let o={};{let e=0;for(let[t,n]of this.c.entries())"key"in n.p?n.p.key in s&&(o[t]=s[n.p.key],delete s[n.p.key]):(e in r&&(o[t]=r[e],delete r[e]),e++)}for(let i of function*(){for(let e in r)yield r[e];for(let e of Reflect.ownKeys(s))yield s[e]}()){e.c[i.i].undoEffect(t.child[i.i]);for(let e of i.node)n.parentNode.removeChild(e)}let c=[],l=n;for(let[n,r]of this.c.entries()){let s;o[n]?(l.nextSibling!=o[n].node[0]&&i(o[n].node,l),s=r.sub(e.c[o[n].i])(t.child[o[n].i])):(s=r.make(t.root),i(s.node,l),r.doEffect(s)),c.push(s),l=s.node.at(-1)}return t.child=c,t.node=[n,...c.flatMap(e=>e.node)],t}:super.sub(e)}undoEffect(e){e.ended||(this.c.map((t,n)=>t.undoEffect(e.child[n])),super.undoEffect(e))}},c=e=>(t,...n)=>new e(t,n);class l{#e=[];#t=0;pop(){let e=this.#e[this.#t];return this.#e[this.#t++]=void 0,this.#t>64&&2*this.#t>this.#e.length&&(this.#e=this.#e.slice(this.#t),this.#t=0),e}push(e){this.#e.push(e)}get size(){return this.#e.length-this.#t}[Symbol.iterator](){return{next:()=>this.size?{value:this.pop(),done:!1}:{done:!0}}}}let f,d,u,h=class{#n;#r;#s=new l;render(e=this.concept){this.#r=e.sub(this.concept)(this.#r),this.concept=e}constructor(e){this.concept=new s({}),this.#r=this.concept.make(this),this.node.append(...this.#r.node),e&&this.render(e)}flush(){for(let e of this.#s)e()}node=new DocumentFragment;push(e){this.#s.push(e),this.#n=this.#n||requestAnimationFrame(()=>{this.#n=0,this.flush()})}unmount(){this.node.append(...this.#r.node)}},a=(e,t)=>e.length==t.length&&e.every((e,n)=>Object.is(e,t[n])),p=(e,t)=>{f.push([e,t])},y=(e,t)=>{let n=f;f=e;try{return t()}finally{f=n}},m=(e,t)=>{let n=w([e,t]);return a(n.current[1],t)||(n.current=[e,t]),n.current[0]},b=(e,t)=>{let n=w(null);return n.current&&a(n.current[1],t)||(n.current=[e(),t]),n.current[0]},w=e=>u in d.ref?d.ref[u++]:d.ref[u++]={current:e},k=e=>{let t=d,n=[e,e=>{t.root.push(()=>{n[0]=e,t.clean=0,t.concept.sub(t.concept)(t)})}];return w(n).current},E=(e,t)=>{let n=d,r=u;d=e,u=0;try{return t()}finally{d=n,u=r}},v=function*(){}.constructor,x=class extends t{constructor(e,t,n){super(e),this.f=t,this.c=n}doEffect(e){e.ended||(super.doEffect(e),e.effect.map(e=>{if(e[0]instanceof v){let t=e[0]();t.next(),e[0]=t.next.bind(t)}else e[0]=e[0]()}),e.functionConcept.doEffect(e.child[0]))}make(e){let t=new n(e);return t.functionConcept=y(t.effect,()=>E(t,()=>this.f(this.p,...this.c))),t.child=[t.functionConcept.make(e)],t.concept=this,t.node=t.child[0].node,t}sub(e){return e instanceof x&&this.f==e.f?t=>{if(((e,t)=>{let n=Reflect.ownKeys(e),r=Reflect.ownKeys(t);return n.length==r.length&&n.every(n=>n in t&&Object.is(e[n],t[n]))})(e.p,this.p)&&a(e.c,this.c)&&t.clean||t.ended)return t;let n=t.functionConcept,r=t.effect,s=[],i=y(s,()=>E(t,()=>this.f(this.p,...this.c))),o=i.sub(n);return r.map((e,t)=>t).filter(e=>{let t=r[e];return!(t[1]&&a(t[1],s[e][1]))}).map(e=>r[e][0]?.()),t.child[0]=o(t.child[0]),t.functionConcept=i,s=s.map((e,t)=>{if(a(e[1],r[t][1]))return r[t];if(e[0]instanceof v){let t=e[0]();t.next(),e[0]=t.next.bind(t)}else e[0]=e[0]();return e}),t.clean=1,t.concept=this,t.effect=s,t.node=t.child[0].node,t}:super.sub(e)}undoEffect(e){e.ended||(e.effect.map(e=>e[0]?.()),e.effect=[],e.functionConcept.undoEffect(e.child[0]),super.undoEffect(e))}},S=e=>(t,...n)=>new x(t,e,n),O=(e,t)=>n=>{let r=n.node[0],s=new Set(["key","ref","checked","innerHTML","style","Style","value"]);if(t.ref&&delete t.ref.current,e.ref&&(e.ref.current=r),Object.is(t.checked,e.checked)||(r.checked=e.checked),Object.is(t.innerHTML,e.innerHTML)||(r.innerHTML=e.innerHTML),!a([t.style,t.Style],[e.style,e.Style]))if("Style"in t||"Style"in e){r.removeAttribute("style"),"Style"in e&&r.setAttribute("style",e.Style),"style"in e&&Object.assign(r.style,e.style);for(let t of Object.keys(e.style||{}))t.includes("-")?r.style.setProperty(t,e.style[t]):r.style[t]=e.style[t]}else for(let n of new Set(Object.keys(e.style||{})).union(new Set(Object.keys(t.style||{}))))e.style&&n in e.style?t.style?.[n]!=e.style[n]&&(n.includes("-")?r.style.setProperty(n,e.style[n]):r.style[n]=e.style[n]):r.style.removeProperty(n);Object.is(t.value,e.value)||(r.value="value"in e?e.value:"");let i=new Set(Object.keys(e)).union(new Set(Object.keys(t))).difference(s);for(let n of[...i].map(e=>e.match(/^[Oo]n(.*)/)).filter(e=>e).map(e=>e[1]))a([t["on"+n],t["On"+n]],[e["on"+n],e["On"+n]])||(r.removeAttribute("on"+n),r["on"+n]=null,"on"+n in e&&(r["on"+n]=e["on"+n]),"On"+n in e&&r.setAttribute("on"+n,e["On"+n])),i.delete("on"+n),i.delete("On"+n);for(let t of i)t in e?r.setAttribute(t,e[t]):r.removeAttribute(t);return n},g=class extends r{constructor(e,t,n){super(t),this.t=e,this.c=n}doEffect(e){e.ended||(super.doEffect(e),new o({},this.c).doEffect(e.child[0]))}make(e){let t=document.createElement(this.t),r=new n(e,[t],[new o({},this.c).make(e)]);for(let e of r.child[0].node)t.appendChild(e);return r=O(this.p,{})(r),this.p.ref&&(this.p.ref.current=t),r}sub(e){return e==this?e=>e:e instanceof g&&this.t==e.t?t=>(new o({},this.c).sub(new o({},e.c))(t.child[0]),O(this.p,e.p)(t)):super.sub(e)}undoEffect(e){e.ended||(new o({},this.c).undoEffect(e.child[0]),super.undoEffect(e))}},C={},j=new Proxy({},{get:(e,t)=>C[t]=C[t]||c(class extends g{constructor(e={},n){super(t,e,n)}})}),T=c(o),A=(e,t)=>new s(e,t);export{T as $fragment,A as $tn,t as Concept,h as Root,S as component,j as dom,m as useCallback,p as useEffect,b as useMemo,w as useRef,k as useState};